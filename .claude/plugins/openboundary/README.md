# OpenBoundary Plugin

A Claude Code plugin that enforces OpenBoundary specification boundaries, preventing accidental edits to generated infrastructure code.

## Installation

### Prerequisites

1. **OpenBoundary CLI** - Required for compilation

   ```bash
   # Install script
   curl -fsSL https://openboundary.org/install.sh | sh

   # Or with Go
   go install github.com/openboundary/openboundary/cmd/bound@latest
   ```

2. **Git** - Required for boundary enforcement (the plugin uses `git diff` to detect violations)

### Enable the Plugin

Add to your project's `.claude/settings.json`:

```json
{
  "plugins": ["openboundary"]
}
```

Or install globally in `~/.claude/settings.json`.

## How It Works

### Boundary Enforcement Model

This plugin uses a **defense-in-depth** approach:

1. **Pre-edit advisory** - Warns before editing protected files
2. **Post-edit enforcement** - Validates no protected files were modified using `git diff`
3. **Rollback capability** - Provides `/ob-rollback` to undo violations

### Safe Zones

| Zone | Files | Editable |
|------|-------|----------|
| **Always Safe** | `spec.yaml`, `openapi.yaml`, `src/auth/*`, `src/db/schema.ts` | Fully |
| **Partial** | `src/components/usecases/*.ts` | Function body only |
| **Forbidden** | `src/components/servers/*`, `src/middleware/*`, `*.generated.ts` | Never |

### The Golden Rule

```typescript
// Generated by OpenBoundary - DO NOT EDIT
```

Files with this marker are **protected infrastructure**. Edit `spec.yaml` and recompile instead.

## Skills

| Skill | Description |
|-------|-------------|
| `/ob-compile` | Compile specification to TypeScript |
| `/ob-validate` | Validate specification without generating |
| `/ob-new-usecase` | Add a new usecase to the specification |
| `/ob-rollback` | Undo changes to protected files |

## Hooks

| Hook | Trigger | Purpose |
|------|---------|---------|
| `pre-edit-boundary-check` | Start | Advisory: warns about protected files |
| `post-edit-enforce` | Stop | **Enforcement**: detects violations via git diff |
| `post-compile-validate` | After compile | Validates generated code |

## Workflow

```
1. Edit spec.yaml          (safe zone)
2. /ob-compile             (generates infrastructure)
3. Implement usecases      (function bodies only)
4. Repeat as needed
```

## Boundary Configuration

All boundary rules are defined in `boundaries.json`:

```json
{
  "safeZones": {
    "always": { "patterns": ["spec.yaml", "src/auth/**/*"] },
    "partial": { "patterns": ["src/components/usecases/*.ts"] }
  },
  "forbidden": {
    "patterns": ["src/components/servers/**/*", "src/middleware/**/*"]
  }
}
```

## Troubleshooting

### "OpenBoundary CLI not found"

Install the CLI:

```bash
curl -fsSL https://openboundary.org/install.sh | sh
```

Or verify it's in your PATH:

```bash
which openboundary || which bound
```

### "Cannot enforce boundaries"

The plugin requires git to detect modifications:

```bash
git init  # If not already a git repo
git add -A && git commit -m "Initial commit"
```

### Boundary Violation Detected

If you accidentally edited a protected file:

```bash
# Option 1: Use the skill
/ob-rollback

# Option 2: Manual rollback
git checkout -- src/components/servers/http-server-api.ts

# Option 3: Rollback all protected files
git checkout -- src/components/servers/ src/middleware/
```

### Plugin Not Activating

Check that your project contains `spec.yaml` or `openboundary.yaml` with:

```yaml
version: "0.1.0"
components:
  - id: ...
```

## Security Model

### What This Plugin CAN Do

- Warn before edits to protected files
- Detect violations after edits using `git diff`
- Provide rollback commands
- Guide toward proper workflow

### What This Plugin CANNOT Do

- Physically prevent the Edit tool from modifying files
- Undo changes automatically (requires user action)
- Protect against intentionally malicious users

### Defense in Depth

For maximum protection:

1. Use git branch protection rules
2. Require PR reviews for changes to `src/components/` and `src/middleware/`
3. Add CI checks that fail if generated files differ from `openboundary compile` output

## Contributing

See the main [OpenBoundary repository](https://github.com/openboundary/openboundary).

## License

AGPL-3.0 - Same as the OpenBoundary project.
