---
name: pre-edit-boundary-check
description: Advisory check before file edits - warns about protected files
model: inherit
---

# Pre-Edit Boundary Check (Advisory)

Before making any file edits in an OpenBoundary project, verify the target file is within safe boundaries.

> **Note:** This is an advisory hook. Enforcement happens in `post-edit-enforce` using git diff.

## Quick Decision Tree

```text
Is file path in forbidden list?
  → src/components/servers/**  → STOP
  → src/middleware/**          → STOP
  → **/index.ts in usecases    → STOP
  → **/schemas.ts in usecases  → STOP
  → *.generated.ts             → STOP
  → package.json/tsconfig.json → STOP

Is file in always-safe list?
  → spec.yaml, openapi.yaml    → PROCEED
  → src/auth/**                → PROCEED
  → src/db/schema.ts           → PROCEED

Is file a usecase implementation?
  → src/components/usecases/*.ts (not index/schemas)
  → Check: only editing function body? → PROCEED
  → Editing imports/types/signature?   → STOP
```

## Forbidden Patterns

These files must NEVER be edited:

```text
src/components/servers/**/*.ts     (generated servers)
src/components/usecases/index.ts   (generated exports)
src/components/usecases/schemas.ts (generated types)
src/components/usecases/types.ts   (generated types)
src/middleware/**/*.ts             (generated middleware)
tests/**/*.generated.ts            (generated tests)
**/*.generated.ts                  (any generated file)
package.json                       (project config)
package-lock.json                  (lock file)
tsconfig.json                      (typescript config)
```

## Always Safe

These files can be freely modified:

```text
spec.yaml, openboundary.yaml       (specification)
openapi.yaml, openapi.yml          (API contracts)
src/auth/**/*.ts                   (auth config)
src/auth/**/*.conf                 (Casbin model)
src/auth/**/*.csv                  (Casbin policy)
src/db/schema.ts                   (database schema)
src/db/seed.ts                     (seed data)
.env.example                       (env template)
```

## Partial Safe: Usecase Files

For `src/components/usecases/*.ts` (excluding index, schemas, types):

1. **Check for marker** in first 5 lines:
   ```text
   // Generated by OpenBoundary - DO NOT EDIT
   ```

2. **If marker present:** Only function body is editable

3. **Editable section:**
   ```typescript
   export async function createUser(...): Promise<...> {
     // ↓ ONLY this content is editable ↓
     const result = await ctx.db.insert(users).values(input);
     return { id: result.insertId };
     // ↑ ONLY this content is editable ↑
   }
   ```

4. **NOT editable:**
   - Imports
   - Type/interface definitions
   - Function signature (name, params, return type)
   - JSDoc comments

## Sensitive Files

Warn (but don't block) for:

```text
.env, .env.local, .env.production  (credentials)
src/auth/*.csv                      (authorization policy)
```

Warning message:

```text
WARNING: Editing sensitive file: {filename}
This file may contain credentials or security policies.
Please verify changes don't introduce vulnerabilities.
```

## Violation Response

If a forbidden file is about to be edited:

```text
BOUNDARY CHECK: Cannot edit {filename}

This file is {reason}. In OpenBoundary projects:
  • Generated infrastructure code must not be modified
  • Changes should be made in spec.yaml, then recompiled

To make this change:
  1. Edit spec.yaml with the new requirement
  2. Run: /ob-compile
  3. Implement business logic in usecase bodies only
```

## Reminder

OpenBoundary separates boundaries from logic:

- **Boundaries** (infrastructure, security, routing) → spec.yaml
- **Logic** (business rules) → usecase function bodies

Respect this separation to maintain system integrity.

## Enforcement Note

This hook provides advisory warnings. The `post-edit-enforce` hook runs after all edits and uses `git diff` to detect any violations that occurred, providing a safety net.
