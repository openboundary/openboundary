---
name: pre-edit-boundary-check
description: Validates that file edits stay within OpenBoundary safe zones
model: inherit
---

# Pre-Edit Boundary Check

Before making any file edits in an OpenBoundary project, verify the target file is within safe boundaries.

## Boundary Rules

### SAFE TO EDIT - No restrictions

These files can be freely modified:

1. **Specification files**
   - `spec.yaml`
   - `openapi.yaml`

2. **Configuration files** (referenced in spec)
   - `src/auth/*.ts` (authentication config)
   - `src/auth/*.conf` (Casbin model)
   - `src/auth/*.csv` (Casbin policy)
   - `src/db/schema.ts` (Drizzle schema)

### PARTIALLY SAFE - Implementation bodies only

For files in `src/components/usecases/*.ts`:

- Check if file contains `// Generated by OpenBoundary - DO NOT EDIT`
- If YES: Only the function body (between opening `{` after signature and closing `}`) may be edited
- Do NOT modify: imports, type definitions, function signatures, JSDoc comments

### NEVER EDIT - Forbidden

Files containing the marker:

```text
// Generated by OpenBoundary - DO NOT EDIT
```

Except for usecase implementation bodies as noted above.

Also forbidden regardless of marker:

- `src/components/servers/*.ts`
- `src/components/usecases/index.ts`
- `src/components/usecases/schemas.ts`
- `src/middleware/*.ts`
- `tests/**/*.ts`
- `package.json`, `tsconfig.json`
- Docker files

## Validation Steps

Before allowing an edit:

1. **Check file path** against safe zone patterns
2. **Read file content** if path could be usecase implementation
3. **Look for DO NOT EDIT marker** in first 5 lines
4. **For usecase files**, ensure edit is only to function body

## If Violation Detected

STOP and inform the user:

```text
BOUNDARY VIOLATION: Cannot edit {filename}

This file is {reason}. In OpenBoundary projects:
- Generated infrastructure code must not be modified
- Changes should be made in spec.yaml, then recompiled

To make this change:
1. Edit spec.yaml with the new requirement
2. Run: openboundary compile spec.yaml
3. Implement business logic in usecase bodies only
```

## Reminder

The purpose of OpenBoundary is to separate boundaries from logic:

- **Boundaries** (infrastructure, security, routing) = spec.yaml
- **Logic** (business rules) = usecase implementation bodies

Respect this separation to maintain system integrity.
